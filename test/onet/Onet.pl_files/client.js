(function(window,undefined){window.Cdf=window.Cdf||{};function picoajax(req){req.method=req.method?req.method.toUpperCase():"GET";var xhr=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;this.stateChange=function(){xhr.readyState==4&&(xhr.status>=200&&xhr.status<300?req.success&&req.success(xhr.responseText,xhr):req.failure&&req.failure(xhr))},xhr.onreadystatechange=this.stateChange;if(typeof req.data=="object"){var t="";for(var v in req.data)t+=(t.length>0?"&":"")+encodeURIComponent(v)+"="+encodeURIComponent(req.data[v]);req.data=t}req.method!="POST"&&req.data&&(req.url=req.url+"?"+req.data),xhr.open(req.method,req.url,!0),req.method=="POST"?(xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhr.send(req.data?req.data:null)):xhr.send()}function getElementByClassName(className){var hasClassName=new RegExp("(?:^|\\s)"+className+"(?:$|\\s)"),allElements=document.getElementsByTagName("*"),results=[],element;for(var i=0;(element=allElements[i])!=null;i++){var elementClass=element.className;elementClass&&elementClass.indexOf(className)!=-1&&hasClassName.test(elementClass)&&results.push(element)}return results}function replaceCdfBlocks(data,xhr,element){var callback=element.getAttribute("data-cdf-block-callback"),scripts=[],resText=data;element.outerHTML=data;while(data.indexOf("<script")>-1||data.indexOf("</script")>-1){var s=data.indexOf("<script"),s_e=data.indexOf(">",s),e=data.indexOf("</script",s),e_e=data.indexOf(">",e);scripts.push(data.substring(s_e+1,e)),data=data.substring(0,s)+data.substring(e_e+1)}for(var i=0;i<scripts.length;i++)try{window.execScript?window.execScript(scripts[i]):eval.call(window,scripts[i])}catch(ex){}if(callback){var parts=callback.split(".");callback=window[parts[0]];for(var i=1,max=parts.length;i<max;i++)callback=callback[parts[i]];typeof callback=="function"&&callback.call(window,!1,{request:xhr,element:element,result:resText,name:element.getAttribute("data-cdf-block-name")})}}window.Cdf.render=function(){var blocks=getElementByClassName("cdfblock");for(var i=0,max=blocks.length;i<max;i++){var block=blocks[i],data=block.getAttribute("data-cdf-block");data&&picoajax({method:"POST",url:"/_cdf/render",data:data,success:function(element){return function(text,response){replaceCdfBlocks(text,response,element)}}(block),failure:function(xhr,element){var callback=element.getAttribute("data-cdf-block-callback");typeof callback=="function"&&callback.call(window,!0,{request:xhr,element:element})}})}},window.Cdf.renderPreset=function(name,params,asJson,cb){params=params||{},typeof cb=="undefined"&&(cb=asJson,asJson=!1);if(name){var data={};asJson?data.json=JSON.stringify(params):data=params,data.____presetName=name,picoajax({method:"GET",url:"/_cdf/api",data:data,success:function(text,xhr){cb(null,xhr,text)},failure:function(xhr){cb(xhr.status,xhr)}})}}})(window),Cdf.render()